<!DOCTYPE html>
<html lang="fr">
<head>
  <!-- ... (بقية ال head كما هي بدون تغيير) ... -->
</head>
<body>
  <!-- ... (بقية ال HTML كما هي بدون تغيير) ... -->

  <script>
    // ... (بقية الكود كما هو بدون تغيير حتى جزء createOrderElement) ...

    // Créer un élément de commande
    function createOrderElement(key, data) {
      const currentStatus = data.etat || data.statut || "En attente";
      const timeInfo = formatOrderTime(data.timestamp);
      
      const div = document.createElement("div");
      div.className = `commande status-${currentStatus.replace(/\s+/g, '-').toLowerCase()}`;
      div.id = `commande-${key}`;
      div.dataset.status = currentStatus;
      
      div.innerHTML = `
        <button class="delete-btn no-print" data-key="${key}">×</button>
        <div class="commande-header">
          <div class="table-number">Table ${data.table}</div>
          <div class="order-time">
            <span>${timeInfo.time}</span>
            <span class="time-ago">${timeInfo.ago}</span>
          </div>
        </div>
        
        <div class="order-items">
          ${data.commandes.map(item => `
            <div class="order-item">
              <div>
                <span class="item-quantity">${item.quantite}x</span>
                ${item.plat}
                ${item.notes ? `<br><small>(${item.notes})</small>` : ''}
              </div>
              <div>${item.prix * item.quantite} MAD</div>
            </div>
          `).join('')}
        </div>
        
        <div class="order-total">Total: ${data.total} MAD</div>
        
        <div class="order-status">
          <label>État :</label>
          <select class="status-select" data-key="${key}">
            <option value="En attente" ${currentStatus === "En attente" ? "selected" : ""}>🕐 En attente</option>
            <option value="En préparation" ${currentStatus === "En préparation" ? "selected" : ""}>👨‍🍳 En préparation</option>
            <option value="Prêt" ${currentStatus === "Prêt" ? "selected" : ""}>✅ Prêt</option>
            <option value="Livré" ${currentStatus === "Livré" ? "selected" : ""}>🛵 Livré</option>
          </select>
        </div>
      `;
      
      // Ajouter un badge pour les nouvelles commandes
      if (Date.now() - data.timestamp < 30000) {
        const badge = document.createElement('div');
        badge.className = 'new-order-badge';
        badge.textContent = '!';
        div.appendChild(badge);
        
        notificationSound.play().catch(e => console.log("Audio playback error:", e));
        
        setTimeout(() => {
          badge.remove();
        }, 30000);
      }
      
      // Écouter les changements d'état (SANS CONFIRMATION)
      div.querySelector('.status-select').addEventListener("change", function() {
        const newStatus = this.value;
        db.ref("commandes/" + key).update({ 
          etat: newStatus,
          statut: newStatus
        });
        
        statusChangeSound.play().catch(e => console.log("Audio playback error:", e));
      });
      
      // Écouter le bouton de suppression (AVEC CONFIRMATION)
      div.querySelector('.delete-btn')?.addEventListener("click", function() {
        if (confirm("Voulez-vous vraiment supprimer cette commande ? Cette action est irréversible.")) {
          db.ref("commandes/" + key).remove();
        }
      });
      
      return div;
    }

    // ... (بقية الكود كما هو بدون تغيير) ...
  </script>
</body>
</html>
