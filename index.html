<!DOCTYPE html>
<html lang="fr">
<head>
  <!-- ... (Ø¨Ù‚ÙŠØ© Ø§Ù„ head ÙƒÙ…Ø§ Ù‡ÙŠ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±) ... -->
</head>
<body>
  <!-- ... (Ø¨Ù‚ÙŠØ© Ø§Ù„ HTML ÙƒÙ…Ø§ Ù‡ÙŠ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±) ... -->

  <script>
    // ... (Ø¨Ù‚ÙŠØ© Ø§Ù„ÙƒÙˆØ¯ ÙƒÙ…Ø§ Ù‡Ùˆ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± Ø­ØªÙ‰ Ø¬Ø²Ø¡ createOrderElement) ...

    // CrÃ©er un Ã©lÃ©ment de commande
    function createOrderElement(key, data) {
      const currentStatus = data.etat || data.statut || "En attente";
      const timeInfo = formatOrderTime(data.timestamp);
      
      const div = document.createElement("div");
      div.className = `commande status-${currentStatus.replace(/\s+/g, '-').toLowerCase()}`;
      div.id = `commande-${key}`;
      div.dataset.status = currentStatus;
      
      div.innerHTML = `
        <button class="delete-btn no-print" data-key="${key}">Ã—</button>
        <div class="commande-header">
          <div class="table-number">Table ${data.table}</div>
          <div class="order-time">
            <span>${timeInfo.time}</span>
            <span class="time-ago">${timeInfo.ago}</span>
          </div>
        </div>
        
        <div class="order-items">
          ${data.commandes.map(item => `
            <div class="order-item">
              <div>
                <span class="item-quantity">${item.quantite}x</span>
                ${item.plat}
                ${item.notes ? `<br><small>(${item.notes})</small>` : ''}
              </div>
              <div>${item.prix * item.quantite} MAD</div>
            </div>
          `).join('')}
        </div>
        
        <div class="order-total">Total: ${data.total} MAD</div>
        
        <div class="order-status">
          <label>Ã‰tat :</label>
          <select class="status-select" data-key="${key}">
            <option value="En attente" ${currentStatus === "En attente" ? "selected" : ""}>ğŸ• En attente</option>
            <option value="En prÃ©paration" ${currentStatus === "En prÃ©paration" ? "selected" : ""}>ğŸ‘¨â€ğŸ³ En prÃ©paration</option>
            <option value="PrÃªt" ${currentStatus === "PrÃªt" ? "selected" : ""}>âœ… PrÃªt</option>
            <option value="LivrÃ©" ${currentStatus === "LivrÃ©" ? "selected" : ""}>ğŸ›µ LivrÃ©</option>
          </select>
        </div>
      `;
      
      // Ajouter un badge pour les nouvelles commandes
      if (Date.now() - data.timestamp < 30000) {
        const badge = document.createElement('div');
        badge.className = 'new-order-badge';
        badge.textContent = '!';
        div.appendChild(badge);
        
        notificationSound.play().catch(e => console.log("Audio playback error:", e));
        
        setTimeout(() => {
          badge.remove();
        }, 30000);
      }
      
      // Ã‰couter les changements d'Ã©tat (SANS CONFIRMATION)
      div.querySelector('.status-select').addEventListener("change", function() {
        const newStatus = this.value;
        db.ref("commandes/" + key).update({ 
          etat: newStatus,
          statut: newStatus
        });
        
        statusChangeSound.play().catch(e => console.log("Audio playback error:", e));
      });
      
      // Ã‰couter le bouton de suppression (AVEC CONFIRMATION)
      div.querySelector('.delete-btn')?.addEventListener("click", function() {
        if (confirm("Voulez-vous vraiment supprimer cette commande ? Cette action est irrÃ©versible.")) {
          db.ref("commandes/" + key).remove();
        }
      });
      
      return div;
    }

    // ... (Ø¨Ù‚ÙŠØ© Ø§Ù„ÙƒÙˆØ¯ ÙƒÙ…Ø§ Ù‡Ùˆ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±) ...
  </script>
</body>
</html>
