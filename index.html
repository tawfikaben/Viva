<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Liste des commandes - Cuisine</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f4f4f4;
    }
    h2 {
      color: #333;
    }
    .commande {
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      margin: 10px 0;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .commande select {
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <h2>📋 Commandes en temps réel</h2>
  <div id="liste-commandes"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <!-- Configuration Firebase -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDpSF4J0bsd6T0ImMpse0KQQRADaxiYUQw",
      authDomain: "darhassna-484c3.firebaseapp.com",
      databaseURL: "https://darhassna-484c3-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "darhassna-484c3",
      storageBucket: "darhassna-484c3.firebasestorage.app",
      messagingSenderId: "141393162149",
      appId: "1:141393162149:web:0717227eac221f5ddfc24c"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const commandesDiv = document.getElementById("liste-commandes");

    db.ref("commandes").on("child_added", (snapshot) => {
      const data = snapshot.val();
      const key = snapshot.key;

      const div = document.createElement("div");
      div.className = "commande";
      div.innerHTML = `
        <strong>${data.nom}</strong> a commandé : <em>${data.plat}</em><br>
        🕒 ${new Date(data.timestamp).toLocaleTimeString()}<br>
        <label for="etat-${key}">État :</label>
        <select id="etat-${key}">
          <option value="En attente" ${data.etat === "En attente" ? "selected" : ""}>🕐 En attente</option>
          <option value="En préparation" ${data.etat === "En préparation" ? "selected" : ""}>👨‍🍳 En préparation</option>
          <option value="Prêt" ${data.etat === "Prêt" ? "selected" : ""}>✅ Prêt</option>
          <option value="Livré" ${data.etat === "Livré" ? "selected" : ""}>🛵 Livré</option>
        </select>
      `;

      // عندما يتم تغيير الحالة
      div.querySelector(`#etat-${key}`).addEventListener("change", function () {
        const nouvelleEtat = this.value;
        db.ref("commandes/" + key).update({ etat: nouvelleEtat });
      });

      commandesDiv.appendChild(div);
    });
  </script>
</body>
</html>
